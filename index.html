<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VPN Import ‚Äî –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #0a0f1e;
      color: white;
      text-align: center;
      padding: 20px;
      margin: 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }
    .container {
      max-width: 600px;
      background: #1a1f2e;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.5);
    }
    h2 { color: #4CAF50; }
    .button {
      display: inline-block;
      background: #4CAF50;
      color: white;
      padding: 12px 24px;
      margin: 8px;
      border-radius: 8px;
      text-decoration: none;
      font-weight: bold;
    }
    .link-box {
      background: #2a2f3e;
      padding: 12px;
      border-radius: 8px;
      word-break: break-all;
      font-size: 12px;
      margin-top: 20px;
      color: #aaa;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>üîÑ –û–ø—Ä–µ–¥–µ–ª—è–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ...</h2>
    <div id="status">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    <div id="fallback" style="display: none;"></div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // ========== –ü–û–õ–£–ß–ê–ï–ú –ü–ê–†–ê–ú–ï–¢–† key ==========
      const params = new URLSearchParams(window.location.search);
      let key = params.get("key");
      
      if (!key) {
        document.body.innerHTML = "<h2>‚ùå –û—à–∏–±–∫–∞: –ø–∞—Ä–∞–º–µ—Ç—Ä 'key' –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω.</h2>";
        return;
      }

      // ========== –î–ï–ö–û–î–ò–†–£–ï–ú –ò –ò–ó–í–õ–ï–ö–ê–ï–ú –ß–ò–°–¢–£–Æ –°–°–´–õ–ö–£ ==========
      try {
        key = decodeURIComponent(key);
      } catch (e) {}
      
      // –û–∂–∏–¥–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç: happ://add/–ß–ò–°–¢–ê–Ø_SUBSCRIPTION_URL
      let subscriptionUrl = key.replace(/^happ:\/\/add\//, '');
      
      // ========== –û–ü–†–ï–î–ï–õ–Ø–ï–ú –ü–õ–ê–¢–§–û–†–ú–£ ==========
      const ua = navigator.userAgent.toLowerCase();
      const isAndroid = ua.includes('android');
      const isIOS = ua.includes('iphone') || ua.includes('ipad') || ua.includes('ipod');
      const isWindows = ua.includes('win');
      const isMac = ua.includes('macintosh');
      const isLinux = ua.includes('linux') && !isAndroid;
      
      // ========== –§–û–†–ú–ò–†–£–ï–ú –°–ü–ò–°–û–ö –ü–†–û–¢–û–ö–û–õ–û–í –î–õ–Ø –ê–í–¢–û–†–ï–î–ò–†–ï–ö–¢–ê ==========
      let urlsToTry = [];
      
      // --- Android ---
      if (isAndroid) {
        urlsToTry = [
          `v2raytun://add/${subscriptionUrl}`,   // V2RayTun (–ª—É—á—à–µ –≤—Å–µ–≥–æ)
          `happ://add/${subscriptionUrl}`,        // Happ
          `hiddify://import/${subscriptionUrl}`,  // Hiddify
          `outline://${subscriptionUrl}`          // Outline
        ];
      }
      // --- iOS ---
      else if (isIOS) {
        urlsToTry = [
          `happ://add/${subscriptionUrl}`,        // Happ
          `fairvpn://import/${subscriptionUrl}`,  // FairVPN
          `hiddify://import/${subscriptionUrl}`,  // Hiddify
          `outline://${subscriptionUrl}`          // Outline
        ];
      }
      // --- Windows ---
      else if (isWindows) {
        urlsToTry = [
          `hiddify://import/${subscriptionUrl}`,  // Hiddify (–ª—É—á—à–µ –Ω–∞ Windows)
          `happ://add/${subscriptionUrl}`,        // Happ
          `outline://${subscriptionUrl}`          // Outline
        ];
      }
      // --- Mac ---
      else if (isMac) {
        urlsToTry = [
          `hiddify://import/${subscriptionUrl}`,  // Hiddify
          `happ://add/${subscriptionUrl}`,        // Happ
          `fairvpn://import/${subscriptionUrl}`   // FairVPN
        ];
      }
      // --- Linux / –æ—Å—Ç–∞–ª—å–Ω—ã–µ ---
      else {
        urlsToTry = [
          `hiddify://import/${subscriptionUrl}`,
          `happ://add/${subscriptionUrl}`
        ];
      }

      // ========== –ü–†–û–ë–£–ï–ú –û–¢–ö–†–´–í–ê–¢–¨ –ü–û –û–ß–ï–†–ï–î–ò ==========
      function tryOpen(index) {
        if (index >= urlsToTry.length) {
          // –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –æ—Ç–∫—Ä—ã–ª–æ—Å—å ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏
          showFallback();
          return;
        }
        
        const url = urlsToTry[index];
        document.getElementById('status').innerHTML = `üîÑ –ü—Ä–æ–±—É–µ–º ${getAppName(url)}...`;
        
        // –ü—ã—Ç–∞–µ–º—Å—è –æ—Ç–∫—Ä—ã—Ç—å
        window.location.href = url;
        
        // –ñ–¥—ë–º –Ω–µ–º–Ω–æ–≥–æ –∏ –ø—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â–∏–π, –µ—Å–ª–∏ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–æ
        setTimeout(() => {
          tryOpen(index + 1);
        }, 800);  // 800 –º—Å ‚Äî –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –æ—Ç–∫—Ä—ã–ª–æ—Å—å
      }

      // ========== –ü–û–ö–ê–ó–´–í–ê–ï–ú –ö–ù–û–ü–ö–ò –î–õ–Ø –†–£–ß–ù–û–ì–û –í–´–ë–û–†–ê ==========
      function showFallback() {
        document.getElementById('status').innerHTML = '‚ö†Ô∏è –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:';
        
        let buttonsHtml = '';
        
        // –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
        const allUrls = [
          { url: `happ://add/${subscriptionUrl}`, name: 'Happ', emoji: 'üì±' },
          { url: `v2raytun://add/${subscriptionUrl}`, name: 'V2RayTun', emoji: 'üì°', hide: !isAndroid },
          { url: `hiddify://import/${subscriptionUrl}`, name: 'Hiddify', emoji: 'üöÄ' },
          { url: `fairvpn://import/${subscriptionUrl}`, name: 'FairVPN', emoji: '‚ú®', hide: !isIOS },
          { url: `outline://${subscriptionUrl}`, name: 'Outline', emoji: 'üîµ' }
        ];
        
        allUrls.forEach(item => {
          if (!item.hide) {
            buttonsHtml += `<a href="${item.url}" class="button">${item.emoji} ${item.name}</a>`;
          }
        });
        
        buttonsHtml += `<div class="link-box">üîó –ß–∏—Å—Ç–∞—è –ø–æ–¥–ø–∏—Å–∫–∞:<br>${subscriptionUrl}</div>`;
        
        document.getElementById('fallback').innerHTML = buttonsHtml;
        document.getElementById('fallback').style.display = 'block';
      }

      // ========== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø ==========
      function getAppName(url) {
        if (url.includes('happ://')) return 'Happ';
        if (url.includes('v2raytun://')) return 'V2RayTun';
        if (url.includes('hiddify://')) return 'Hiddify';
        if (url.includes('fairvpn://')) return 'FairVPN';
        if (url.includes('outline://')) return 'Outline';
        return '–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ';
      }

      // ========== –ó–ê–ü–£–°–ö–ê–ï–ú ==========
      tryOpen(0);
    });
  </script>
</body>
</html>
