<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="theme-color" content="#000000">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>███ VPN BOOT — LEVEL 5 ███</title>
  <style>
    /* ===== ПОЛНЫЙ СБРОС ===== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: #000;
      font-family: 'Courier New', Courier, 'Fira Code', monospace;
      font-size: 16px;
      line-height: 1.4;
    }

    body {
      background: radial-gradient(circle at 50% 50%, #0c1a0f, #030503);
      color: #00ff88;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
      text-shadow: 0 0 5px #00ff88;
    }

    /* ===== АНИМАЦИЯ МАТРИЦЫ ===== */
    .matrix-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      background: repeating-linear-gradient(
        0deg,
        rgba(0, 255, 136, 0.03) 0px,
        transparent 1px,
        transparent 3px
      );
      animation: matrix 12s linear infinite;
      z-index: 0;
    }

    @keyframes matrix {
      0% { transform: translateY(0); }
      100% { transform: translateY(100%); }
    }

    /* ===== ЧАСТИЦЫ (КИБЕРПАНК) ===== */
    .particles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1;
    }

    .particle {
      position: absolute;
      width: 2px;
      height: 2px;
      background: #00ff88;
      box-shadow: 0 0 10px #00ff88;
      opacity: 0.5;
      animation: float 8s infinite linear;
    }

    @keyframes float {
      0% { transform: translateY(100vh) translateX(0); opacity: 0; }
      20% { opacity: 0.8; }
      100% { transform: translateY(-20vh) translateX(20vw); opacity: 0; }
    }

    /* ===== ОСНОВНОЙ КОНТЕЙНЕР ===== */
    .screen {
      position: relative;
      z-index: 20;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    /* ===== ТЕРМИНАЛЬНЫЙ БЛОК ===== */
    .terminal {
      width: 100%;
      max-width: 900px;
      background: rgba(0, 20, 10, 0.85);
      backdrop-filter: blur(8px);
      border: 1px solid #00ff88;
      box-shadow: 0 0 40px rgba(0, 255, 136, 0.2);
      border-radius: 16px;
      padding: clamp(20px, 5vw, 40px);
      position: relative;
      overflow: hidden;
    }

    /* Эффект разбитого стекла (глитч) */
    .terminal::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(45deg, 
        rgba(0,255,136,0.1) 0%, 
        transparent 20%,
        rgba(255,0,136,0.05) 50%,
        transparent 80%,
        rgba(0,255,136,0.1) 100%
      );
      pointer-events: none;
      animation: glitch 0.2s infinite;
    }

    @keyframes glitch {
      0% { opacity: 0.2; transform: translate(0); }
      20% { opacity: 0.3; transform: translate(-1px, 1px); }
      40% { opacity: 0.25; transform: translate(1px, -1px); }
      60% { opacity: 0.3; transform: translate(-1px, -1px); }
      80% { opacity: 0.2; transform: translate(1px, 1px); }
      100% { opacity: 0.2; transform: translate(0); }
    }

    /* ===== ASCII АРТ (ОГРОМНЫЙ) ===== */
    .ascii-art {
      font-size: clamp(6px, 2vw, 12px);
      line-height: 1.1;
      color: #00ff88;
      text-shadow: 0 0 8px #00ff88;
      margin-bottom: 20px;
      white-space: pre;
      text-align: center;
      letter-spacing: 2px;
    }

    /* ===== СТАТУС ===== */
    .status-line {
      font-size: clamp(16px, 4vw, 24px);
      margin: 20px 0;
      padding: 10px 20px;
      border-left: 4px solid #00ff88;
      background: rgba(0, 255, 136, 0.05);
      text-transform: uppercase;
      letter-spacing: 6px;
    }

    /* ===== ТАЙМЕР ===== */
    .timer {
      font-size: clamp(100px, 30vw, 220px);
      font-weight: 900;
      color: #00ff88;
      text-shadow: 
        0 0 30px #00ff88,
        0 0 60px #00ff88,
        0 0 90px #00cc66;
      line-height: 1;
      animation: pulse 1.2s infinite;
      margin: 30px 0;
    }

    @keyframes pulse {
      0% { opacity: 0.9; transform: scale(1); }
      50% { opacity: 1; transform: scale(1.05); }
      100% { opacity: 0.9; transform: scale(1); }
    }

    /* ===== ПРОГРЕСС БАР ===== */
    .progress-container {
      width: 100%;
      height: 8px;
      background: rgba(0, 255, 136, 0.2);
      border-radius: 4px;
      margin: 30px 0;
      overflow: hidden;
    }

    .progress-bar {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #00ff88, #00cc66);
      box-shadow: 0 0 20px #00ff88;
      transition: width 0.2s ease;
    }

    /* ===== ЛОГ ТЕРМИНАЛА ===== */
    .log {
      margin-top: 30px;
      text-align: left;
      font-size: clamp(12px, 3vw, 14px);
      color: #aaffaa;
      border-top: 1px solid #00ff88;
      padding-top: 20px;
    }

    .log-line {
      margin: 6px 0;
      display: flex;
      align-items: center;
    }

    .prompt {
      color: #00ff88;
      margin-right: 10px;
    }

    .cursor {
      display: inline-block;
      width: 10px;
      height: 18px;
      background: #00ff88;
      animation: blink 1s step-end infinite;
    }

    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0; }
    }

    /* ===== КНОПКА НА ВЕСЬ ЭКРАН ===== */
    .fullscreen-button {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      background: rgba(0, 0, 0, 0.95);
      backdrop-filter: blur(20px);
      z-index: 9999;
      padding: 20px;
    }

    .big-button {
      border: 4px solid #00ff88;
      padding: clamp(30px, 10vw, 80px);
      background: rgba(0, 255, 136, 0.1);
      box-shadow: 0 0 60px rgba(0, 255, 136, 0.4);
      text-align: center;
      animation: borderPulse 2s infinite;
      text-decoration: none;
      display: inline-block;
    }

    .big-button-text {
      font-size: clamp(28px, 10vw, 64px);
      font-weight: 900;
      color: #00ff88;
      text-transform: uppercase;
      letter-spacing: 16px;
      text-shadow: 0 0 30px #00ff88;
    }

    .big-button-sub {
      font-size: clamp(14px, 4vw, 20px);
      color: #fff;
      margin-top: 20px;
      opacity: 0.9;
    }

    @keyframes borderPulse {
      0% { border-color: #00ff88; box-shadow: 0 0 40px #00ff88; }
      50% { border-color: #00cc66; box-shadow: 0 0 80px #00cc66; }
      100% { border-color: #00ff88; box-shadow: 0 0 40px #00ff88; }
    }

    /* ===== ЭКРАН ОШИБКИ (ТОЖЕ ЭПИЧНО) ===== */
    .error-screen {
      text-align: center;
      max-width: 800px;
    }

    .error-code {
      font-size: clamp(30px, 8vw, 60px);
      color: #ff3366;
      text-shadow: 0 0 20px #ff3366;
      margin-bottom: 20px;
    }

    .error-message {
      font-size: clamp(16px, 4vw, 20px);
      color: #ff8888;
      margin-bottom: 40px;
    }

    /* ===== АДАПТАЦИЯ ДЛЯ ТЕЛЕФОНОВ ===== */
    @supports (-webkit-touch-callout: none) {
      body {
        height: -webkit-fill-available;
      }
    }

    .hidden {
      display: none !important;
    }

    /* ===== СИСТЕМНАЯ ИНФОРМАЦИЯ ===== */
    .sys-footer {
      position: fixed;
      bottom: 10px;
      left: 20px;
      font-size: 10px;
      color: rgba(0, 255, 136, 0.5);
      text-align: left;
      z-index: 100;
    }
  </style>
</head>
<body>
  <!-- ФОН МАТРИЦА -->
  <div class="matrix-bg"></div>
  
  <!-- ЧАСТИЦЫ (ГЕНЕРИРУЕМ 50 ШТУК ЧЕРЕЗ JS) -->
  <div id="particles" class="particles"></div>

  <!-- ОСНОВНОЙ ЭКРАН (СОДЕРЖИМОЕ БУДЕТ ПОДСТАВЛЕНО JS) -->
  <div id="app" class="screen"></div>

  <!-- СИСТЕМНЫЙ ФУТЕР -->
  <div class="sys-footer">
    [VPN SECURITY NODE] — okak6766.dedyn.io<br>
    [PROTOCOL] VLESS+REALITY | [AES-256-GCM]<br>
    [UPTIME] 99.98% | [SIGNAL] -54dBm
  </div>

  <script>
    (function() {
      "use strict";

      // Генератор частиц
      function initParticles() {
        const particlesContainer = document.getElementById('particles');
        for (let i = 0; i < 50; i++) {
          const particle = document.createElement('div');
          particle.className = 'particle';
          const size = Math.floor(Math.random() * 3) + 1;
          particle.style.width = size + 'px';
          particle.style.height = size + 'px';
          particle.style.left = Math.random() * 100 + '%';
          particle.style.animationDelay = Math.random() * 8 + 's';
          particle.style.animationDuration = (Math.random() * 10 + 5) + 's';
          particle.style.background = Math.random() > 0.5 ? '#00ff88' : '#00cc66';
          particlesContainer.appendChild(particle);
        }
      }
      initParticles();

      // ========== ПОЛУЧАЕМ ПАРАМЕТР key ==========
      const urlParams = new URLSearchParams(window.location.search);
      const key = urlParams.get('key');
      const appDiv = document.getElementById('app');

      // ========== ЕСЛИ КЛЮЧА НЕТ — ПОКАЗЫВАЕМ ЭПИЧНУЮ ОШИБКУ ==========
      if (!key) {
        appDiv.innerHTML = `
          <div class="terminal error-screen">
            <div class="ascii-art">
╔══════════════════════════════════════════════════════════════════╗
║  ███████╗██████╗ ██████╗  ██████╗ ██████╗     ██╗  ██╗███████╗██╗   ██╗ ║
║  ██╔════╝██╔══██╗██╔══██╗██╔═══██╗██╔══██╗    ██║ ██╔╝██╔════╝╚██╗ ██╔╝ ║
║  █████╗  ██████╔╝██████╔╝██║   ██║██████╔╝    █████╔╝ █████╗   ╚████╔╝  ║
║  ██╔══╝  ██╔══██╗██╔══██╗██║   ██║██╔══██╗    ██╔═██╗ ██╔══╝    ╚██╔╝   ║
║  ███████╗██║  ██║██║  ██║╚██████╔╝██║  ██║    ██║  ██╗███████╗   ██║    ║
║  ╚══════╝╚═╝  ╚═╝╚═╝  ╚═╝ ╚═════╝ ╚═╝  ╚═╝    ╚═╝  ╚═╝╚══════╝   ╚═╝    ║
╚══════════════════════════════════════════════════════════════════╝
            </div>
            <div style="color: #ff3366; font-size: clamp(24px, 6vw, 48px); margin: 20px 0; text-shadow: 0 0 20px #ff3366;">
              ⚠️ ACCESS DENIED ⚠️
            </div>
            <div style="color: #ff8888; font-size: 18px; margin-bottom: 30px;">
              AUTHENTICATION KEY MISSING
            </div>
            <div style="background: rgba(255, 51, 102, 0.1); border: 1px solid #ff3366; padding: 20px; border-radius: 8px;">
              <span style="color: #ff8888;">➤</span> ТРЕБУЕТСЯ ПАРАМЕТР <span style="color: #ff3366; font-weight: bold;">?key=...</span><br>
              <span style="color: #ff8888;">➤</span> ИСПОЛЬЗУЙТЕ ГЕНЕРАТОР ССЫЛОК<br>
              <span style="color: #ff8888;">➤</span> ПРИМЕР: <span style="color: #00ff88;">https://egor83839473.github.io/VPN/?key=happ%3A%2F%2Fadd%2F...</span>
            </div>
          </div>
        `;
        return;
      }

      // ========== ДЕКОДИРУЕМ КЛЮЧ ==========
      let decodedKey;
      try {
        decodedKey = decodeURIComponent(key);
      } catch (e) {
        decodedKey = key;
      }

      // Извлекаем чистую подписку (убираем happ://add/ если есть)
      const subscriptionUrl = decodedKey.startsWith('happ://add/') 
        ? decodedKey.replace('happ://add/', '') 
        : decodedKey;

      // ========== ОСНОВНОЙ ИНТЕРФЕЙС (С АНИМАЦИЕЙ) ==========
      appDiv.innerHTML = `
        <div class="terminal" id="terminal">
          <div class="ascii-art">
╔═══════════════════════════════════════════════════════════════════════════════════════════════════╗
║  ██╗   ██╗██████╗ ███╗   ██╗    ███████╗██╗  ██╗███████╗██████╗ ██╗███╗   ██╗ █████╗ ██╗         ║
║  ██║   ██║██╔══██╗████╗  ██║    ██╔════╝██║  ██║██╔════╝██╔══██╗██║████╗  ██║██╔══██╗██║         ║
║  ██║   ██║██████╔╝██╔██╗ ██║    ███████╗███████║█████╗  ██████╔╝██║██╔██╗ ██║███████║██║         ║
║  ╚██╗ ██╔╝██╔═══╝ ██║╚██╗██║    ╚════██║██╔══██║██╔══╝  ██╔══██╗██║██║╚██╗██║██╔══██║██║         ║
║   ╚████╔╝ ██║     ██║ ╚████║    ███████║██║  ██║███████╗██║  ██║██║██║ ╚████║██║  ██║███████╗    ║
║    ╚═══╝  ╚═╝     ╚═╝  ╚═══╝    ╚══════╝╚═╝  ╚═╝╚══════╝╚═╝  ╚═╝╚═╝╚═╝  ╚═══╝╚═╝  ╚═╝╚══════╝    ║
╚═══════════════════════════════════════════════════════════════════════════════════════════════════╝
          </div>
          
          <div id="statusMessage" class="status-line">⧗ INITIALIZING SECURE BOOT SEQUENCE...</div>
          
          <div id="timerDisplay" class="timer">3</div>
          
          <div class="progress-container">
            <div id="progressBar" class="progress-bar" style="width: 0%;"></div>
          </div>
          
          <div class="log" id="logContainer">
            <div class="log-line">
              <span class="prompt">[root@vpn ~]#</span>
              <span id="logLine1">systemctl start vpn-tunnel.service</span>
              <span class="cursor"></span>
            </div>
            <div class="log-line" id="logLine2" style="opacity: 0.6;"></div>
            <div class="log-line" id="logLine3" style="opacity: 0.4;"></div>
          </div>
          
          <div style="margin-top: 20px; font-size: 12px; color: #6aff9f; border-top: 1px solid #00ff88; padding-top: 15px; display: flex; justify-content: space-between;">
            <span>NODE: okak6766.dedyn.io:2096</span>
            <span>PROTO: VLESS/REALITY</span>
            <span>ID: ${subscriptionUrl.split('/').pop() || '****'}</span>
          </div>
        </div>
      `;

      // ========== ЭЛЕМЕНТЫ ДЛЯ АНИМАЦИИ ==========
      const timerEl = document.getElementById('timerDisplay');
      const progressBar = document.getElementById('progressBar');
      const statusEl = document.getElementById('statusMessage');
      const logLine1 = document.getElementById('logLine1');
      const logLine2 = document.getElementById('logLine2');
      const logLine3 = document.getElementById('logLine3');

      // ========== ЛОГИ АНИМАЦИИ ==========
      const bootLogs = [
        "> LOADING ENCRYPTION MODULES... OK",
        "> ESTABLISHING HANDSHAKE WITH NODE... OK",
        "> NEGOTIATING TLS 1.3... OK",
        "> REALITY PROTOCOL ACTIVE",
        "> TUNNEL MTU: 1500 bytes",
        "> RTT: 47ms",
        "> AUTHENTICATING... OK",
        "> ALLOCATING VIRTUAL INTERFACE... OK",
        "> SECURE CHANNEL ESTABLISHED"
      ];

      let logIndex = 0;
      let count = 3;
      
      // Обновление логов
      const logInterval = setInterval(() => {
        if (logIndex < bootLogs.length) {
          if (logIndex === 0) logLine1.innerHTML = bootLogs[0];
          else if (logIndex === 1) logLine2.innerHTML = bootLogs[1];
          else if (logIndex === 2) logLine3.innerHTML = bootLogs[2];
          else {
            // Добавляем новые строки в лог
            const newLine = document.createElement('div');
            newLine.className = 'log-line';
            newLine.innerHTML = `<span class="prompt">></span> ${bootLogs[logIndex]}`;
            document.getElementById('logContainer').appendChild(newLine);
          }
          logIndex++;
        } else {
          clearInterval(logInterval);
        }
      }, 400);

      // ========== ТАЙМЕР ==========
      const timer = setInterval(() => {
        count--;
        if (count >= 1) {
          timerEl.textContent = count;
          progressBar.style.width = `${(3 - count) * 33}%`;
          statusEl.textContent = count === 2 
            ? '⧗ DECRYPTING SESSION KEYS...' 
            : '⧗ ESTABLISHING TUNNEL...';
        } else {
          clearInterval(timer);
          timerEl.textContent = 'GO';
          progressBar.style.width = '100%';
          statusEl.textContent = '✅ CONNECTION ESTABLISHED — LAUNCHING APPLICATION...';
          
          // Добавляем финальный лог
          const finalLog = document.createElement('div');
          finalLog.className = 'log-line';
          finalLog.innerHTML = '<span class="prompt">[✔]</span> <span style="color: #00ff88;">TUNNEL READY — REDIRECTING...</span>';
          document.getElementById('logContainer').appendChild(finalLog);

          // ========== РЕДИРЕКТ ==========
          setTimeout(() => {
            window.location.href = decodedKey;
          }, 600);

          // ========== ФОЛБЭК КНОПКА ==========
          setTimeout(() => {
            if (!document.hidden) {
              // Создаём кнопку на весь экран
              const fallbackDiv = document.createElement('div');
              fallbackDiv.className = 'fullscreen-button';
              fallbackDiv.id = 'fallbackButton';
              fallbackDiv.innerHTML = `
                <a href="${decodedKey}" class="big-button" style="text-decoration: none;">
                  <div class="big-button-text">⏎ ACTIVATE ⏎</div>
                  <div class="big-button-sub">MANUAL CONNECTION REQUIRED</div>
                  <div style="margin-top: 20px; color: #aaffaa; font-size: 14px; word-break: break-all;">
                    ${decodedKey.substring(0, 80)}...
                  </div>
                </a>
              `;
              document.body.appendChild(fallbackDiv);
            }
          }, 2000);
        }
      }, 1000);

    })();
  </script>
</body>
</html>
